import java.util.{Timer, TimerTask}

class Debouncer(delayMs: Long) {
  private val timer = new Timer()
  private var currentTask: Option[TimerTask] = None

  // 传入要防抖的任务，新调用会取消旧任务并重新计时
  def debounce(task: => Unit): Unit = {
    // 取消当前等待的任务（若存在）
    currentTask.foreach(_.cancel())
    // 创建新任务并延迟执行
    val newTask = new TimerTask {
      override def run(): Unit = task
    }
    currentTask = Some(newTask)
    timer.schedule(newTask, delayMs)
  }

  // 关闭定时器（避免内存泄漏）
  def shutdown(): Unit = timer.cancel()
}

// 使用示例
val debouncer = new Debouncer(500) // 500毫秒防抖窗口
debouncer.debounce(println("执行1")) // 被取消
debouncer.debounce(println("执行2")) // 被取消
debouncer.debounce(println("执行3")) // 最终执行
